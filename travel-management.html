<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/keycloak-js@22.0.3/dist/keycloak.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.bare.js" ></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.js"></script>

<head>
	<link rel="icon" href="http://10.196.7.108:8060/F.ico">
    <title>出差管理/出差總覽</title>
</head>
<body>
    <div id="TravelManagement">
        <!--http://10.35.22.72:88/static/images/logo.png-->
        <!--/static/images/logo.png-->
        <img v-if="!isPortal" class="header-logo" src="http://10.35.22.72:88/static/images/logo.png">

        <p v-if="!isPortal" class="page-title">&emsp;出差總覽</p>
        
        <!--登入按鈕-->
        <login-module 
            :auth-object-array="authObjectArray" 
            @update-auth="updateUserAuth"
            @update-portal="updatePortal"
            @update-user="updateUser">

        </login-module>

        <div v-if="!isViewer" class="vh-100 d-flex justify-content-md-center align-items-center">
            <button class="text-light bg-secondary rounded p-2">{{loginFailMsg}}</button>
        </div>
        <template v-else>

        

            <div class="header"></div>
            <!--搜尋列-->
            <div class="custom-bar d-flex">
                <b-col class="d-flex justify-content-md-center align-items-center">
                    越南廠區：
                    <b-dropdown :text="selectedVnFactory" variant="primary me-5">
                        <b-dropdown-item v-for="(item) in factoryList" :key="item" @click="selectedVnFactory=item">{{item}}</b-dropdown-item>
                    </b-dropdown>
                
                    SBU：
                    <b-dropdown :text="selectedSBU" variant="primary me-5">
                        <b-dropdown-item v-for="(item) in sbuList" :key="item" @click="selectedSBU=item">{{item}}</b-dropdown-item>
                    </b-dropdown>
                
                    原屬廠區：
                    <b-dropdown :text="selectedRealFactory" variant="primary me-5">
                        <b-dropdown-item v-for="(item) in RealfactoryList" :key="item" @click="selectedRealFactory=item">{{item}}</b-dropdown-item>
                    </b-dropdown>
    
                    <!--機台：
                    <b-dropdown :text="selectedEquipment" variant="primary me-5">
                        <b-dropdown-item v-for="(item) in equipmentList" :key="item" @click="selectedEquipment=item">{{item}}</b-dropdown-item>
                    </b-dropdown> -->
                    關鍵字：
                    <b-col class="col-2 me-3">
                        <b-form-input
                            placeholder="輸入關鍵字搜尋"
                            v-model="selectName"
                            class="mb-sm-0">
                        </b-form-input>
                    </b-col>


                    <!--處理搜尋日期
                    <div>日期:</div>
                    <input type="date" v-model="searchDate" v-on:change="searchProcess"/>-->
                    
                    <template>
                        從
                        <input class="me-3" type="date" v-model="startDate" @change="filterProcess"/>
                        到
                        <input class="me-5" type="date" v-model="endDate"@change="filterProcess"/>
                    </template>
                
                    <b-button variant="primary" @click="searchProcess()">搜尋</b-button>
                    <p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> 
                    
                    
                </b-col>
            </div>

        
            <hr>

            <!--圖表
            <div v-show="showChart" class="mt-1" style="height:30vh; background-color: #2c3034;">
                <canvas id="theChart"></canvas>
            </div>-->

            <hr>
        
            
            <!--小表單內容-->
            <b-container class="custom-container">
                <b-row class="d-flex justify-content-md-center">
                    <div class="button-container">
                    <b-col cols="4" class="d-flex justify-content-start align-items-center">
                        <b-button v-if="isEditor" class="me-3" variant="success" @click="itemInsert(null)" style="white-space: nowrap;">新增人員</b-button>
                        <p style="margin-right: 20px;"></p>
                        <!--檔案匯入-->
                        <template>
                            <div>
                                
                                <b-button variant="primary" @click="importmodal" style="white-space: nowrap;">檔案匯入</b-button>
                                <b-modal 
                                    hide-footer
                                    header-bg-variant="costom-modal"
                                    body-bg-variant="costom-modal"
                                    size="xl" 
                                    id="modalimport" 
                                    title="選擇檔案">
                                    <b-button @click="chooseFile" variant="primary" style="white-space: nowrap;">選擇檔案</b-button>
                                    <b-button v-if="processDone === true" variant="primary" @click="startApiProcess" :disabled="uploadButtonDisabled" >上傳</b-button>
                                    <b-button v-else disabled>上傳</b-button>
                                    <input ref="fileInput" type="file" id="excelFile" accept=".xls, .xlsx" style="display: none" @change="handleFileChange">
                                   
                                    <b-table
                                        ref="tableImport"
                                        class="custom-table-import"
                                        sticky-header="60vh"
                                        show-empty
                                        Bordered  
                                        :busy.sync="showOverlay"  
                                        :items="itemsImport"
                                        no-provider-filtering
                                        :fields="importfields"
                                        empty-text="無內容"
                                        :filter="filter"
                                        :filter-included-fields="filterOn"
                                        @filtered="onFiltered"
                                        :tbody-tr-class="rowClass"
                                        responsive
                                        label-sort-asc=""
                                        label-sort-desc=""
                                        label-sort-clear=""
                                        >
                                        <!--序號-->
                                        <template #cell(index)="{ item, index}">
                                            {{(perPage!=='All'?(currentPage-1)*perPage:0) + index +1}}
                                            <div v-if="Object.values(item).findIndex(x=>x===undefined)!==-1">
                                                資訊缺漏!
                                            </div>
                                        </template>
    
                                        <!--上傳狀態-->
                                        <template #cell(uploadstatus)="{ item, index}">
                                            <p v-html="statusUpload[index]"></p>
                                        </template>
                                    </b-table>
                                </b-modal>
                            </div>
                        </template>
                        <template>
                            <p style="margin-right: 40px;"></p>
                            <div>
                            <b-button v-if="candownload"  @click="exportFile" variant="primary" style="white-space: nowrap;" >匯出Excel</b-button>
                            </div>
                            <p style="margin-right: 40px;"></p>
                            <div>
                            <b-button @click="exportnullFile" variant="primary" style="white-space: nowrap;">匯出空白Excel</b-button>
                            </div>
                        </template>
                        <p style="margin-right: 50px;"></p>
                        <b-col cols="3" class="custom-bar d-flex justify-content-end align-items-center" >
                        <b-dropdown text="欄位管理" right>
                            <b-dropdown-form>
                                <b-form-checkbox-group
                                    v-model="visibleKeys"
                                    :options="fields.filter(x=>!x.fixed)"
                                    value-field="key"
                                    text-field="label"
                                    class="custom-checkbox text-white"
                                ></b-form-checkbox-group>
                            </b-dropdown-form>
                        </b-dropdown>
                    </b-col>
                    </div>
                    <b-col cols="8" class="d-flex justify-content-md-center align-items-center"> 
                        {{countStr}}
                    </b-col>
                </b-row>
                <!-- 表格元件 & Pagination -->
                <b-overlay 
                    variant="dark"
                    :show="showOverlay" 
                    rounded="sm">
                    <!--編輯框&表格元件 -->
                    <b-row class="mt-3 justify-content-center">
                        
                        <!--大表格table -->
                        
                        <b-table
                            ref="table"
                            class="custom-table"
                            sticky-header="60vh"
                            show-empty
                            Bordered  
                            dark
                            :busy.sync="showOverlay"  
                            :items="items"
                            no-provider-filtering
                            :fields="fields.filter(x=>visibleKeys.includes(x.key))"
                            :current-page="currentPage"
                            :per-page="perPage==='All'?Number.MAX_SAFE_INTEGER:perPage"
                            empty-text="無內容"
                            :filter="filter"
                            :filter-included-fields="filterOn"
                            @filtered="onFiltered"
                            :tbody-tr-class="validClass"
                            label-sort-asc=""
                            label-sort-desc=""
                            label-sort-clear=""
                            responsive
                        >
                            <!--工作任務標頭(置中)-->
                            <template #head(work_task)="data">
                                <div class="text-center">
                                    {{data.label}}
                                </div>
                            </template>

                            <!--序號-->
                            <template #cell(index)="{ item, index}">
                                <div v-if="isEditor" class="mytooltip pointer">
                                    <b-button v-if="isEditor" v-b-tooltip.hover variant="link":title="isEditor ? '編輯此項目' : ''" @click="itemEdit(item)">
                                        {{(perPage!=='All'?(currentPage-1)*perPage:0) + index +1}}
                                    </b-button>
                                    
                                </div>
                                <template v-else>
                                    {{(perPage!=='All'?(currentPage-1)*perPage:0) + index +1}}
                                </template>
                            </template>
    
                            <!--工作任務-->
                            <template #cell(work_task)="{ item, index}">
                                <span v-html="toHtml(item.work_task)">
                                </span>
                            </template>

                            
                        </b-table>
                    </b-row>
                    <!-- Pagination -->
                    <b-row class="col-12 align-items-center">
                        <b-col md="6" class="my-1 d-flex justify-content-end">
                            每頁筆數：<b-form-select :options="pageOptions" v-model="perPage" />
                        </b-col>
                        <b-col md="6" class="my-1 d-flex justify-content-start">
                            <b-pagination 
                                first-number
                                last-number
                                :total-rows="items.length" 
                                :per-page="perPage==='All'?Number.MAX_SAFE_INTEGER:perPage" 
                                v-model="currentPage" 
                                class="my-0"/>
                        </b-col>
                    </b-row>
                </b-overlay>
            </b-container>



        </template>

        
        <!--對話框(修改項目)-->
        <b-modal id="modal-item-edit"
            scrollable
            @shown="editModalShown(true)"
            @hidden="editModalShown(false)"
            header-bg-variant="costom-modal"
            body-bg-variant="costom-modal"
            @ok="updatetravelSummary()"
        >
            <template #modal-title class="text-center">
                出差人員 - 
                <template v-if="selectedEditItem.new">
                    新增項目
                </template>
                <template v-else>
                    修改項目
                </template>
            </template>

            <template #modal-footer="{ cancel, ok}">
                <b-button v-if="!selectedEditItem.new && isEditor" variant="danger"  @click="mangerDelete()" v-b-modal.modal-item-delete-confirm>
                    刪除
                </b-button>
                <b-button  @click="cancel()">
                    取消
                </b-button>
                <b-button v-if="travelSelectedEditItemIsValid()===true" variant="primary" @click="ok()">
                    {{selectedEditItem.new?"新增":"修改"}}
                </b-button>
                <b-button v-else disabled>
                    {{selectedEditItem.new?"新增":"修改"}}
                </b-button>
                <b-row v-if="!selectedEditItem.new">
                    <b-col class="d-flex justify-content-end">
                        <b-button variant="primary" @click="itemInsert(selectedEditItem)">複製以下內容來新增</b-button>
                    </b-col>
                </b-row>
            </template>

            <template v-for="item in fields">
                <template v-if="item.key !== 'index'">
                    <b>{{item.label}}：</b>
                    

                    <!--下拉選單綁訂填寫項目-->
                    <template v-if="item.key==='real_factory'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.real_factory"
                                :options="realfactoryOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='sbu'">
                            <div>
                                <b-form-select
                                    class="w-100"
                                    class="my-custom-select"
                                    v-model="selectedEditItem.sbu"
                                    :options="sbuOptions"
                                ></b-form-select>
                            </div>
                    </template>
                    <template v-else-if="item.key==='real_unit'">
                            <div>
                                <b-form-select
                                    class="w-100"
                                    class="my-custom-select"
                                    v-model="selectedEditItem.real_unit"
                                    :options="realunitOptions"
                                ></b-form-select>
                            </div>
                    </template>
                    <template v-else-if="item.key==='visa'">
                            <div>
                                <b-form-select
                                    class="w-100"
                                    class="my-custom-select"
                                    v-model="selectedEditItem.visa"
                                    :options="visaOptions"
                                ></b-form-select>
                            </div>
                    </template>
                    <template v-else-if="item.key==='resident'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.resident"
                                :options="residentOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='vn_factory'">
                            <div>
                                <b-form-select
                                    class="w-100"
                                    class="my-custom-select"
                                    v-model="selectedEditItem.vn_factory"
                                    :options="vnfactoryOptions"
                                ></b-form-select>
                            </div>
                    </template>
                    <template v-else-if="item.key==='vn_unit'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.vn_unit"
                                :options="vnunitOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='document'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.document"
                                :options="documentOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='travel_order'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.travel_order"
                                :options="travelrdOerOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='credentials_issue'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.credentials_issue"
                                :options="credentialsIssueOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='credentials_allot'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.credentials_allot"
                                :options="commonOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='hostel'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.hostel"
                                :options="hostelOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='management_table'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.hostel"
                                :options="managementOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    <template v-else-if="item.key==='key'">
                        <div>
                            <b-form-select
                                class="w-100"
                                class="my-custom-select"
                                v-model="selectedEditItem.hostel"
                                :options="keyOptions"
                            ></b-form-select>
                        </div>
                    </template>
                    
                    
                    
                
                    <b-form-input 
                        v-else-if="item.key==='time'" 
                        v-model="selectedEditItem[item.key]"
                        type="date"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>

                    <span v-else-if="item.key==='work_number' && !selectedEditItem.new" >
                        {{selectedEditItem[item.key]}}
                    </span>
                    <span v-else-if="item.key==='vn_date' && !selectedEditItem.new" >
                        {{localizeDate(selectedEditItem[item.key])}}
                    </span>
                    <span v-else-if="item.key==='days'" >
                        {{selectedEditItem[item.key]}}
                    </span>
                    <!--vn_date為必填，框要變色-->
                    <b-form-input 
                        v-else-if="item.key==='vn_date'" 
                        v-model="selectedEditItem[item.key]"
                        :state="selectedEditItem[item.key] !== ''"
                        type="date"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>
                    <b-form-input 
                        v-else-if="item.key==='back_date'" 
                        v-model="selectedEditItem[item.key]"
                        type="date"
                        :min="selectedEditItem.vn_date"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>
                    <b-form-input 
                        v-else-if="item.key==='vn_date' || item.key==='visa_date'" 
                        v-model="selectedEditItem[item.key]"
                        
                        type="date"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>
                    <b-form-textarea
                        v-else-if="item.key==='work_task'"
                        v-model="selectedEditItem[item.key]" 
                        :placeholder="'輸入'+item.label"
                        rows="2"
                        max-rows="10"
                    ></b-form-textarea>
                    <b-form-input 
                        v-else-if="item.must"
                        v-model="selectedEditItem[item.key]"
                        :list="'my-list-'+item.key"
                        :placeholder="'輸入'+item.label"
                        :state="selectedEditItem[item.key] !== ''"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>
                    <b-form-input 
                        v-else
                        v-model="selectedEditItem[item.key]"
                        :list="'my-list-'+item.key"
                        :placeholder="'輸入'+item.label"
                        class="mb-2 mr-sm-2 mb-sm-0"></b-form-input>
                    <br>
                </template>
            </template>
            
            
            <!--下面是輸入欄位的預設選項-->
            <datalist id="my-list-product">
                <option v-for="item in selectedItemProductList">{{item}}</option>
            </datalist>

            <datalist id="my-list-equipment">
                <option v-for="item in selectedItemEquipmentList">{{item}}</option>
            </datalist>

            
        </b-modal>
        <!--對話框(確認刪除項目)-->
        <b-modal id="modal-item-delete-confirm" 
            scrollable
            header-bg-variant="costom-modal"
            body-bg-variant="costom-modal"
            @ok="deletetravelSummary()"
        >
            <template #modal-title class="text-center">
                人員 - 刪除項目確認
            </template>
            <template #modal-footer="{ cancel, ok}">
                <b-button  @click="cancel()">
                    取消
                </b-button>
                <b-button variant="primary" @click="ok()">
                    確定
                </b-button>
            </template>

            確定刪除此項目？
            
        </b-modal>
        <!--刪除人員項目-->
        <b-modal id="modal-identifier-delete-confirm" 
            scrollable
            header-bg-variant="costom-modal"
            body-bg-variant="costom-modal"
            @ok="deleteidentifier()"
        >
            <template #modal-title class="text-center">
                人員 - 刪除項目確認
            </template>
            <template #modal-footer="{ cancel, ok}">
                <b-button  @click="cancel()">
                    取消
                </b-button>
                <b-button variant="primary" @click="ok()">
                    確定
                </b-button>
            </template>

            確定刪除此項目？
            
        </b-modal>

        <div class="footer">
            <span style="cursor: pointer;" @click="showVersion">version: {{version}}</span>
        </div>
    </div>
</body>

<script src="/component/loginModule.js"></script>
<script>

    var app = new Vue({
        el: '#TravelManagement',
        data(){
            return {
                map: [],
                selectedVnFactory: "All",
                sbuOrigin: ['ACE','EMS','IDS1','IDS2','IDS3','TPENPI','海外製造處','越南廠區周邊機能',],
                vnFactoryOrigin:["雲中","義安","黃田"],
                realFactoryOrigin:['昆山','雲中','台北','鄭州','寶科','黃田','義安'],
                residentOptions:['出差','長駐'],
                vnunitOptions:[
                    {value: '', text: '選擇越南單位(必填項目)', disabled: true},
                    'ABS','ACE','FAD','EMS','IDS1','IDS2','IDS3','海外製造處','中央',],
                hostelOptions:['','富貴城','龍城','祥運','南勝','北江'],
                commonOptions:['','已完成','未完成'],
                documentOptions:['','已完成','未完成'],
                travelrdOerOptions:['','已完成','未完成'],
                credentialsIssueOptions:['','已完成','未完成'],
                managementOptions:['','已完成','未完成'],
                keyOptions:['','已完成','未完成'],

                selectedcommon: "未完成",
                selectedDocument:"未完成",
                selectedTravelOrder:"未完成",
                selectedCredentialsIssue:"未完成",
                selectedCredentialsAllot:"未完成",
                selectedhostel: "ALL",
                selectedSBU: "All",
                selectedRealFactory: "All",
                selectedEquipment: "All",
                startDate: "",
                endDate: "",
                selectedStatus: "",
                selectedfrequency: "",
                realunitOptions:[
                    {value: '', text: '選擇原屬單位(必填項目)', disabled: true},
                    '自動化','品保','製工','企劃','衝壓','成型','電鍍','裝配','中央','IE','PM',],
                realfactoryOptions:[
                    {value: '', text: '選擇原屬廠區(必填項目)', disabled: true},
                    '昆山','雲中','台北','鄭州','寶科','義安','淮安','重慶',],
                sbuOptions:[
                    {value: '', text: '選擇SBU(必填項目)', disabled: true},
                    'ACE','EMS','IDS1','IDS2','IDS3','TPENPI','海外製造處','越南廠區周邊機能',],
                visaOptions:[
                    {value: '', text: '選擇簽證別(必填項目)', disabled: true},
                    '工作','商務'],
                vnfactoryOptions:[
                    {value: '', text: '選擇越南廠區(必填項目)', disabled: true},
                    '雲中','黃田','義安'],

                countStr: "",
                selectedItem:{},        //選取的item
                selectedEditItem: {},   //選取後修改的item
                selectName:"",
                searchDate:'',
                searchResult:[],
                originalItems: [],
                rawItems:[],
                rawItemsAfterSelection: [],
                items: [],
                itemsImport:[],
                statusUpload:[],
                uploadIdx: 0,
                modalimport:[],
                startDate: "",
                endDate: "",

                showChart: true,
                theChart: null,


                importfields:[
                                { key: "index",             label: "項次",      fixed: true,   must: false, sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "name",              label: "姓名",      fixed: true,   must: true,  sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "work_number",       label: "工號",      fixed: true,   must: true,  sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "sbu",               label: "SBU",       fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "real_factory",      label: "原屬廠區",  fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "real_unit",         label: "原屬單位",  fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "unit_number",       label: "部門代碼",  fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "grade",             label: "資位",      fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "position",          label: "職位",      fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_date",           label: "赴越日期",  fixed: true,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}},
                                { key: "back_date",         label: "返國時間",  fixed: true,   must: false, sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}},
                                { key: "days",              label: "天數",      fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "visa_date",         label: "友誼關",    fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}}, 
                                { key: "visa",              label: "簽證別",    fixed: false,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "resident",          label: "長駐",      fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_factory",        label: "越南廠區",  fixed: false,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_unit",           label: "越南單位",  fixed: false,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "work_task",         label: "工作任務",  fixed: false,   must: false, sortable: true,  'class': 'text-start align-middle',thStyle: { minWidth: "20rem" }},
                                { key: "window",            label: "提報窗口",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "management_table",  label: "管理表",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "document",          label: "公文申請",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "travel_order",      label: "差旅單",    fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "credentials_issue", label: "廠證申請",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "credentials_allot", label: "廠證發放",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "key",               label: "宿舍鑰匙",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "shuttle",           label: "接駁車安排",fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "8rem" }},
                                { key: "hostel",            label: "宿舍安排",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                ],
                fields: 
                        [
                                { key: "index",             label: "項次",      fixed: true,   must: false, sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "name",              label: "姓名",      fixed: true,   must: true,  sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "work_number",       label: "工號",      fixed: true,   must: true,  sortable: false, 'class': 'text-center align-middle',thStyle: { minWidth: "5rem" }},
                                { key: "sbu",               label: "SBU",       fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "real_factory",      label: "原屬廠區",  fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "real_unit",         label: "原屬單位",  fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "unit_number",       label: "部門代碼",  fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "grade",             label: "資位",      fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "position",          label: "職位",      fixed: true,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_date",           label: "赴越日期",  fixed: true,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}},
                                { key: "back_date",         label: "返國時間",  fixed: true,   must: false, sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}},
                                { key: "days",              label: "天數",      fixed: true,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "visa_date",         label: "友誼關",    fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }, formatter: value=>{return this.localizeDate(value ,'(未填寫)')}}, 
                                { key: "visa",              label: "簽證別",    fixed: false,   must: true,  sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "resident",          label: "長駐",      fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_factory",        label: "越南廠區",  fixed: false,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "vn_unit",           label: "越南單位",  fixed: false,   must: true,  sortable: true,  'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "work_task",         label: "工作任務",  fixed: false,   must: false, sortable: true,  'class': 'text-start align-middle',thStyle: { minWidth: "20rem" }},
                                { key: "window",            label: "提報窗口",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "management_table",  label: "管理表",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "document",          label: "公文申請",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "travel_order",      label: "差旅單",    fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "credentials_issue", label: "廠證申請",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "credentials_allot", label: "廠證發放",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "key",               label: "宿舍鑰匙",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                                { key: "shuttle",           label: "接駁車安排",fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "8rem" }},
                                { key: "hostel",            label: "宿舍安排",  fixed: false,   must: false, sortable: true, 'class': 'text-center align-middle',thStyle: { minWidth: "7rem" }},
                ],
                
                visibleKeys: [],

                showColumnOptions: false,
                modifiedExcelData: [],
                excelData: [],
                items: [], 
                processDone: false,

                editModalIsShown: false,


                currentPage: 1,
                perPage: 10,
                totalRows: 0,
                pageOptions: [ 5, 10, 20, 100],
                sortBy: null,
                sortDesc: false,
                sortDirection: 'asc',
                filter: null,
                filterOn: ["userName", "firstName", "lastName", "email", "ldapInfo",],

                showOverlay: false,
                
                devMode: false,

                loginFailMsg: "權限不足或登入失敗，請以觀看人員或編輯人員權限登入！",

                //版本相關變量
                version: "V1.08",
                //建議把versionHistory倒置。最新的寫在最上面
                versionHistory: [
                "V1.08:[24/06/13]修正各案有換行問題及間距。",
                "V1.07:[24/05/13]修正因增加項次導致時間解析錯誤，及讀取檔案格式錯位問題，原屬廠區增加淮安,重慶。",
                "V1.06:[24/05/07]修改錯誤導致格式錯位，及錯字。",
                "V1.05:[24/04/25]限制返國日期須大於赴越日期。", 
                "V1.04:[24/04/17]新增複製資料上傳按鈕，且修改時無法更動赴越日期。",   
                "V1.03:[24/04/15]新增日期過濾，修改匯入匯出時間錯誤問題。",
                "V1.02:[24/04/12]修改匯出日期格式，可同檔匯入不會造成日期天數計算消失。",
                "V1.01:[24/03/29]修正匯入資料判定；調整「工作任務」欄寬；新增項目的順位放最後；調整工號為唯一鍵(編輯時固定的項目)；修正越南廠區篩選器的功能；優化工作任務的換行排版；修正新增編輯頁面的項目對應",
                "V1.00: 初版",
                ],
                
                isPortal: true,
                isViewer: true,
                isEditor: true,
                candownload:true,
                userInfo: {},
            }
        },
        
        created: function(){
            //設定時間

            let d = new Date();
            this.endDate = d.toISOString().slice(0,10);
            d.setMonth(d.getMonth()-1);
            this.startDate = d.toISOString().slice(0,10);
            //this.searchDate = new Date().toISOString().slice(0,10);
            this.visibleKeys = this.fields.map(x=>x.key);
            
            
        },
        mounted: function(){
            this.searchProcess();
        },
        unmounted: function(){
        },
        watch:{
            'selectedEditItem.vn_date': function(newValue) {
                //console.log("IN1: " + this.selectedEditItem.back_date)

                if(this.selectedEditItem.back_date === "")
                {
                    this.selectedEditItem.days = "";
                }
                else if(new Date(this.selectedEditItem.vn_date) > new Date(this.selectedEditItem.back_date))
                {
                    this.selectedEditItem.back_date = "";
                    this.selectedEditItem.days = "";
                }
                else
                {
                    this.selectedEditItem.days = this.calculateDays(newValue, this.selectedEditItem.back_date);
                }
            },
            'selectedEditItem.back_date': function(newValue) {
                //console.log("IN2: " + newValue)
                if(newValue === "")
                {
                    this.selectedEditItem.days = "";
                }
                else if(new Date(this.selectedEditItem.vn_date) > new Date(this.selectedEditItem.back_date))
                {
                    this.selectedEditItem.back_date = this.selectedEditItem.vn_date;
                    this.selectedEditItem.days = this.calculateDays(this.selectedEditItem.vn_date, newValue);
                }
                else
                {
                    this.selectedEditItem.days = this.calculateDays(this.selectedEditItem.vn_date, newValue);
                }
            },
            
            startDate: function(){
                let dStart = new Date(this.startDate);
                let dEnd = new Date(this.endDate);
                if(dStart.getTime() > dEnd.getTime())
                {
                    //把endDate改掉
                    dEnd = new Date(this.startDate);
                    dEnd.setMonth(dEnd.getMonth()+1);
                    this.endDate = dEnd.toISOString().slice(0, 10);
                }
            },
            endDate: function(){
                let dStart = new Date(this.startDate);
                let dEnd = new Date(this.endDate);
                if(dStart.getTime() > dEnd.getTime())
                {
                    //startDate
                    dStart = new Date(this.endDate);
                    dStart.setMonth(dStart.getMonth()-1);
                    this.startDate = dStart.toISOString().slice(0, 10);
                }
            },

            selectedVnFactory: function(newValue){
                this.filterProcess();
            },
            selectedSBU: function(newValue){
                this.filterProcess();
            },
            selectedRealFactory: function(newValue){
                this.filterProcess();
            },
            selectName: function(newValue){
                this.filterProcess();

            },
        },
        computed: {
            //搜尋清單
            factoryList:{
                get(){
                    let res = ["All"];

                    res = res.concat(this. vnFactoryOrigin);
                    
                    return res;
                },
            },

            sbuList:{
                get(){
                    let res = ["All"];

                    res = res.concat(this. sbuOrigin);
                    
                    return res;
                },
            },
            RealfactoryList:{
                get(){
                    let res = ["All"];
                    res = res.concat(this. realFactoryOrigin);
                    this.map.filter((item)=>{
                        return (this.selectedSBU === "All" || this.selectedSBU === item.sbu);
                    }).forEach(mapItem=>{
                        if(res.indexOf(mapItem.description) === -1)
                        {
                            res.push(mapItem.description);
                        }
                    });

                    this.selectedRealFactory = res[0];
                    return res;
                },
            },
            equipmentList:{
                get(){
                    
                    let res = ["All"];

                    this.map.filter((item)=>{
                        return (this.selectedSBU === "All" || this.selectedSBU === item.sbu) &&
                                (this.selectedRealFactory === "All" || this.selectedRealFactory === item.check_name);
                    }).forEach(mapItem=>{
                        if(res.indexOf(mapItem.equipment) === -1)
                        {
                            res.push(mapItem.equipment);
                        }
                    });

                    this.selectedEquipment = res[0];
                    
                    return res;
                },
            },

            selectedItemProductList:{
                get(){
                    let res = [];
                    
                    if(this.selectedEditItem !== undefined && this.selectedEditItem.function !== undefined)
                    {
                        this.map.filter((item)=>{
                            return (this.selectedEditItem.function === item.function);
                        }).forEach(mapItem=>{
                            if(res.indexOf(mapItem.description) === -1)
                        {
                            res.push(mapItem.description);
                        }
                        });
                    }
                    
                    return res;
                },
            },
            selectedItemEquipmentList:{
                get(){
                    let res = [];
                    if(this.selectedEditItem !== undefined && 
                        this.selectedEditItem.function !== undefined && 
                        this.selectedEditItem.product !== undefined)
                    {
                        this.map.filter((item)=>{
                            return (this.selectedEditItem.function === item.function) &&
                                    (this.selectedEditItem.product === item.description);
                        }).forEach(mapItem=>{
                            if(res.indexOf(mapItem.equipment) === -1)
                            {
                                res.push(mapItem.equipment);
                            }
                        });
                    }
                    
                    return res;
                },
            },

            //權限設定
            authObjectArray:{
                get(){
                    return [{
                            name: "isViewer",
                            resource: "travel-management",
                            attribute: "觀看權限",
                        },{
                            name: "isEditor",
                            resource: "travel-management",
                            attribute: "新增修改權限",
                        },{
                            name: "candownload",
                            resource: "travel-management",
                            attribute: "資料權限",
                        }
                    ];
                },
            },
        },
        
        methods:{
            //Api.Get/更新主頁面
            searchProcess(){
                /*
                //for test start
                
                let response = {"success":true,"msg":"success","data":[{"id":74,"index":1,"name":"朱豐龍","work_number":"FIT0730","sbu":"海外製造處","real_factory":"雲中","real_unit":"","grade":"師11","position":"資深經理","vn_date":"2024-02-18T00:00:00.000Z","back_date":"1970-01-01T00:00:00.000Z","days":0,"visa_date":"1970-01-01T00:00:00.000Z","visa":"工作","resident":"V","vn_factory":"雲中","vn_unit":"海外製造處","work_task":"","document":"","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":511,"index":2,"name":"林國華","work_number":"FIT0304","sbu":"越南廠區週邊機能","real_factory":"雲中","real_unit":"","grade":"師6","position":"課長","vn_date":"2024-02-18T00:00:00.000Z","back_date":"1970-01-01T00:00:00.000Z","days":0,"visa_date":"1970-01-01T00:00:00.000Z","visa":"工作","resident":"V","vn_factory":"雲中","vn_unit":"中央總務","work_task":"","document":"","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":5,"index":3,"name":"李佳千","work_number":"FIT0821","sbu":"TPE NPI","real_factory":"臺北","real_unit":"TPE NPI","grade":"師2","position":"NA","vn_date":"2024-02-18T00:00:00.000Z","back_date":"2024-03-30T00:00:00.000Z","days":42,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"中央企劃","work_task":"協助conn bu 建廠採購處理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"龍城"},{"id":6,"index":4,"name":"周志成","work_number":"F0837199","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師5","position":"無","vn_date":"2024-02-18T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":91,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":" 派駐提報人員(IDS1)\n1.前期負責SP5後面段自動線體連線調試\n2.後期配合生技協助處理生產異常","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":7,"index":5,"name":"肖宇航","work_number":"F0841043","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師3","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":90,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"派駐提報人員(IDS1)\n1.前期負責SP5後段自動線體連線調試\n2.後期配合生技協助處理生產異常","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":8,"index":6,"name":"何能健","work_number":"F0842589","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":90,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"負責SP5後段自動線體連線調試，結合調試進度視情況再安排回國(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":9,"index":7,"name":"王益","work_number":"F0842307","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師3","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":90,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"派駐提報人員(IDS1)\n負責SP5/SKT E/SKT V線體AOI設備異常處理及日常維護","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":10,"index":8,"name":"莫郁吟","work_number":"F0841879","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師4","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":90,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"負責SP5/SKT E/SKT V線體電控異常處理及日常維護(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":11,"index":9,"name":"王浩","work_number":"F0841847","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-18T00:00:00.000Z","days":90,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"負責SP5後段機臺調試及植球不良分析&改善，結合調試進度視情況再安排回國(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":12,"index":10,"name":"汪貽元","work_number":"F0823109","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師4","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"負責日常生產管理(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":13,"index":11,"name":"岑月風","work_number":"F0531590","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"員2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"負責日常生產和人員培訓(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":14,"index":12,"name":"王偉","work_number":"F0842426","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師4","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"生技負責生產異常處理及機臺的日常維護(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":15,"index":13,"name":"楊歡","work_number":"F4548882","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師1","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"生技負責生產異常處理及機臺的日常維護(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":16,"index":14,"name":"雷宇航","work_number":"F0840985","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"負責日常生產和人員培訓(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":17,"index":15,"name":"蔔巧鳳","work_number":"F0826031","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師1","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"負責日常生產和人員培訓(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":18,"index":16,"name":"楊志","work_number":"F0822518","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"生技負責生產異常處理及機臺的日常維護(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":19,"index":17,"name":"陳柏洋","work_number":"F8838361","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師1","position":"線長","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"負責線內日常生產管理(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":20,"index":18,"name":"盧科","work_number":"F0840968","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師3","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"1.負責量測室的程式編寫與維護(IDS1)\n2.量測室的異常處理.\n3.配合生產做產品測試.","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":21,"index":19,"name":"李春波","work_number":"F0841693","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"1.客戶稽核資料提供(IDS1)\n2.客戶承認資料提供\n3.品質異常處理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":22,"index":20,"name":"畢亞宙","work_number":"F0841111","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"1.客戶稽核資料提供(IDS1)\n2.客戶承認資料提供\n3.品質異常處理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":23,"index":21,"name":"鐘關全","work_number":"F1106947","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師1","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"配合生產品質檢驗(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":24,"index":22,"name":"賴小勇","work_number":"F0833424","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1企劃","grade":"師2","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1企劃","work_task":"負責計劃排配/人員及物料的管理、協調溝通聯絡事宜(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":25,"index":23,"name":"陳作才","work_number":"F2373688","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1企劃","grade":"師1","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-05-11T00:00:00.000Z","days":83,"visa_date":"2024-03-17T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1企劃","work_task":"倉管負責倉庫日常管理(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":26,"index":24,"name":"葉小建","work_number":"X2001668","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1工程","grade":"師3","position":"無","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1工程","work_task":"配合應對2月份AMD與3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":27,"index":25,"name":"沈維民","work_number":"FIT1099","sbu":"IDS1","real_factory":"臺北","real_unit":"IDS1品保","grade":"師8","position":"副理","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":26,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"中央品保","work_task":"越南中央品保主管,配合應對2月份AMD與3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":28,"index":26,"name":"劉志穎","work_number":"F0539139","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1裝配","grade":"師8","position":"副理","vn_date":"2024-02-19T00:00:00.000Z","back_date":"2024-03-14T00:00:00.000Z","days":25,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS1裝配","work_task":"配合應對2月份AMD和3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":29,"index":27,"name":"朱少華","work_number":"H2322764","sbu":"IDS","real_factory":"鄭州","real_unit":"企劃","grade":"師4","position":"無","vn_date":"2024-02-23T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":29,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS","work_task":"1.場地layout處理（水/電/氣定位）\n2.與營建溝通線體施工細項，氣壓/設備電壓確保符等要求","document":"ｖ","travel_order":"ｖ","credentials_issue":"△","credentials_allot":"△","flight":"ｖ","shuttle":"ｖ","hostel":"祥運"},{"id":30,"index":28,"name":"田雨偉","work_number":"F0841158","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"師2","position":"無","vn_date":"2024-02-24T00:00:00.000Z","back_date":"2024-05-24T00:00:00.000Z","days":91,"visa_date":"2024-02-24T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"設備到越南后的承接，從接設備到搬運/安裝對接機臺/調試等相關工作，后期的機臺維修保養","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":31,"index":29,"name":"劉聰","work_number":"F2333688","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"師1","position":"無","vn_date":"2024-02-24T00:00:00.000Z","back_date":"2024-05-24T00:00:00.000Z","days":91,"visa_date":"2024-02-24T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"設備到越南后的承接，從接設備到搬運/安裝對接機臺/調試等相關工作，后期的機臺維修保養","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":32,"index":30,"name":"杜長青","work_number":"F0806614","sbu":"IDS PL3","real_factory":"寶科","real_unit":"中央環安衛","grade":"師6","position":"專理","vn_date":"2024-02-24T00:00:00.000Z","back_date":"2024-03-08T00:00:00.000Z","days":14,"visa_date":"2024-02-24T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"中央環安衛","work_task":"RBA審核","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":33,"index":31,"name":"張守創","work_number":"F0835228","sbu":"IDS PL3","real_factory":"寶科","real_unit":"中央IE","grade":"師4","position":"副課長","vn_date":"2024-02-24T00:00:00.000Z","back_date":"2024-03-08T00:00:00.000Z","days":14,"visa_date":"2024-02-24T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"中央IE","work_task":"企劃事宜聯絡","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":34,"index":32,"name":"鍾隆政","work_number":"FIT0582","sbu":"ACE","real_factory":"雲中","real_unit":"","grade":"師10","position":"經理","vn_date":"2024-02-26T00:00:00.000Z","back_date":"1970-01-01T00:00:00.000Z","days":0,"visa_date":"1970-01-01T00:00:00.000Z","visa":"工作","resident":"V","vn_factory":"雲中","vn_unit":"ACE","work_task":"","document":"","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":"富貴城"},{"id":35,"index":33,"name":"李振國","work_number":"F0520138","sbu":"IDS PL2","real_factory":"鄭州","real_unit":"企劃","grade":"師3","position":"無","vn_date":"2024-02-26T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":90,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"雲中","vn_unit":"IDS PL2","work_task":"零件進料入庫/出庫/流程建立及倉庫日常事宜\n1.倉庫區域規劃/限高安全標識等\n2.零件進料入庫/出庫/驗收/帳物管理\n3.成品出貨/條碼等倉庫相關流程建立及日常事宜","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"祥運"},{"id":36,"index":34,"name":"李國慶","work_number":"F0825495","sbu":"IDS PL2","real_factory":"鄭州","real_unit":"品保","grade":"師4","position":"/","vn_date":"2024-02-26T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":90,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"雲中","vn_unit":"IDS PL2品保","work_task":"1.依產品品質實際需求制訂or修改產品檢驗標準,產品品質計劃（管制計劃）品質系統品質標準落實維護,完善.\n2.對產品操作方式、測試治具及規格、標準進行確認、協同ME及相關單位尋找導致品質不良的結症,并尋找求其原因及問題解決.\n3.對QC人員教育訓練,指導IPQC、做好製程品質檢驗及稽核,及時確認及處置各項缺失,了解客戶品質要求.\n4.製程異常，零件來料異常處理及時分析、驗證、處理各項不良狀況,并配合跟催相關單位作好實際改善動作,在進行資料處理的同時,作好追蹤查核.\n5.降低內部失效成本.\n6.客訴問題的追蹤與解決.","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":37,"index":35,"name":"肜建茹","work_number":"H4209952","sbu":"IDS PL2","real_factory":"鄭州","real_unit":"品保","grade":"師1 ","position":"/","vn_date":"2024-02-26T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":90,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"雲中","vn_unit":"IDS PL2品保","work_task":"1.初件取樣/送測(尺寸/焊板/IR)\n2.IPQC制程巡檢/機臺點檢\n3.FQC抽樣(標簽/包裝/物料)\n4.初件&巡迴結果確認簽核\n5.功能性測試(保持力/拔出力/封裝拉力等)\n6.清換線點檢/紅單物料隔離/改善對策追蹤稽核.\n7.樣品看板/品質履歷維護.\n8.表單確認簽核.\n9.現場異常處理.\n10.GRR考核.\n11.HF/ROHS/信賴性測試送測","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":38,"index":36,"name":"吳棟宇","work_number":"F0841171","sbu":"IDS PL2","real_factory":"深圳","real_unit":"裝配","grade":"師3","position":"無","vn_date":"2024-02-28T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":24,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS-裝配-(PL2)-VN","work_task":"線體LAYOUT擺放確認，設備調試，線體安裝，組裝/檢測機臺/整線 評估OK。\nbk移轉越南料號aoi ce/評估/良率提升維護/移轉","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":39,"index":37,"name":"曾濤","work_number":"F0534413","sbu":"IDS PL2","real_factory":"深圳","real_unit":"裝配","grade":"師6","position":"專理","vn_date":"2024-02-28T00:00:00.000Z","back_date":"2024-03-07T00:00:00.000Z","days":9,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS-裝配-(PL2)-VN","work_task":"統籌23年10月-11月BK移轉VN裝配料號相關事項\n1..BK移轉VN裝配生產力建立\n2.VN人力培養/安全生產/人員培訓等,提升人員綜合能力\n3.bk移轉VN系列品質/成本/交期/安全/人員/產量/現場管理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":40,"index":38,"name":"鄒英明","work_number":"F0829257","sbu":"IDS PL2","real_factory":"深圳","real_unit":"裝配","grade":"師4","position":"組長","vn_date":"2024-02-28T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":24,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS-裝配-(PL2)-VN","work_task":"製程工程師\n1.負責BK移轉VN料號制程異常分析及改善相關事項\n2.負責製造流程圖/表單文件修改与發行\n3.負責產品良率提升及不良品收集&問題點分析改善\n4.針對VN幹部做品質提升/異常分析教育訓練","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":41,"index":39,"name":"曾巍","work_number":"F0822503","sbu":"IDS PL2","real_factory":"深圳","real_unit":"裝配","grade":"師1","position":"線長","vn_date":"2024-02-28T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":24,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS-裝配-(PL2)-VN","work_task":"搬遷越南雲中裝配段機台報關，線體LAYOUT擺放確認，組裝/檢測機臺/整線 評估OK，設備到越南一周後建產生產能力。 ","document":"ｖ","travel_order":"ｖ","credentials_issue":"△","credentials_allot":"△","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":42,"index":40,"name":"王東明","work_number":" F0100444","sbu":"ACE","real_factory":"昆山","real_unit":"IE課","grade":"師7","position":"課長","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-05-24T00:00:00.000Z","days":86,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"","vn_factory":"雲中","vn_unit":"中央廠務","work_task":"1.義安水服務合同跟進法務\n2.義安廠務補充人力專業培訓\n3.辦公設備申請\n4.配合建廠規劃義安園區公共設施規劃提報需求\n5.配合各SBU入駐義安園區生產順暢，篩選有責任/誠信協力廠商\n6.中越兩國光伏電站建設法律法規對光伏電站政策","document":"ｖ","travel_order":"ｖ","credentials_issue":"△","credentials_allot":"△","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":43,"index":41,"name":"劉白羽","work_number":"J0275385","sbu":"海外製造處","real_factory":"雲中","real_unit":"","grade":"師6","position":"課長","vn_date":"2024-02-29T00:00:00.000Z","back_date":"1970-01-01T00:00:00.000Z","days":0,"visa_date":"1970-01-01T00:00:00.000Z","visa":"工作","resident":"V","vn_factory":"雲中","vn_unit":"海外製造處","work_task":"","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":44,"index":42,"name":"黃子耀","work_number":"TW19200","sbu":"IDS1","real_factory":"臺北","real_unit":"IDS1工程","grade":"師6","position":"專理","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-03-13T00:00:00.000Z","days":14,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1工程","work_task":"配合應對2月份AMD與3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":45,"index":43,"name":"翟文賢","work_number":"F0842570","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"試用師2","position":"無","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":87,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"設備到越南后的承接，從接設備到搬運/安裝對接機臺/調試等相關工作，后期的機臺維修保養","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":46,"index":44,"name":"陳禮飛","work_number":"F0841904","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"師4","position":"無","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":87,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"設備到越南后的承接，從接設備到搬運/安裝對接機臺/調試等相關工作，后期的電控處理，越南員工培訓","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":47,"index":45,"name":"何水生","work_number":"G4520382","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"師1","position":"無","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":87,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"生產線長（車間線體的清潔/物料準備確認/樣品對校/設備的開機準備等相關工作）","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":48,"index":46,"name":"申紅蓮","work_number":"F9507309","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3裝配","grade":"師2","position":"無","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-05-25T00:00:00.000Z","days":87,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3裝配","work_task":"組長兼PE負責線體搬遷&線體評估&制程異常","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":49,"index":47,"name":"張柳慶","work_number":"F0842522","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3自動化","grade":"師3","position":"無","vn_date":"2024-02-29T00:00:00.000Z","back_date":"2024-04-06T00:00:00.000Z","days":38,"visa_date":"2024-03-24T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3自動化","work_task":"AOI調試","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"ｖ","shuttle":"ｖ","hostel":"南勝"},{"id":50,"index":48,"name":"卓建安","work_number":"FIT0242","sbu":"IDS PL3","real_factory":"臺北","real_unit":"IDS3自動化","grade":"師8","position":"副理","vn_date":"2024-03-04T00:00:00.000Z","back_date":"2024-03-29T00:00:00.000Z","days":26,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3自動化","work_task":"專案leader","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"","shuttle":"","hostel":""},{"id":51,"index":49,"name":"羅鄖丹","work_number":"F0817886","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師4","position":"無","vn_date":"2024-03-05T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":11,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"協助AMD/Intel  audit (IDS1)","document":"ｖ","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":52,"index":50,"name":"楊世嘉","work_number":"FIT1054","sbu":"EMS","real_factory":"昆山","real_unit":"企劃","grade":"師6","position":"專理","vn_date":"2024-03-05T00:00:00.000Z","back_date":"2024-03-11T00:00:00.000Z","days":7,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"黃田","vn_unit":"FAD","work_task":"EMS 與 FAD 協談後續人員與管理規劃","document":"ｖ","travel_order":"ｖ","credentials_issue":"△","credentials_allot":"△","flight":"","shuttle":"","hostel":""},{"id":53,"index":51,"name":"王雙宏","work_number":"K0010749","sbu":"EMS","real_factory":"昆山","real_unit":"企劃","grade":"師6","position":"無","vn_date":"2024-03-05T00:00:00.000Z","back_date":"2024-03-11T00:00:00.000Z","days":7,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"黃田","vn_unit":"FAD","work_task":"黃田現場查勘倉庫場地&管理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":54,"index":52,"name":"武鋒","work_number":"J0249916","sbu":"EMS","real_factory":"昆山","real_unit":"企劃","grade":"師6","position":"副課長","vn_date":"2024-03-05T00:00:00.000Z","back_date":"2024-03-11T00:00:00.000Z","days":7,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"X","vn_factory":"黃田","vn_unit":"FAD","work_task":"黃田B03二樓場地 整體Layout規劃","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":55,"index":53,"name":"鐘一","work_number":"J0528247","sbu":"ACE","real_factory":"昆山","real_unit":"ACE企劃","grade":"師2","position":"無","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"1.協助越南廠區beats案件SFC系統的建立\n2.相關SFC軟硬件的安裝與處理","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":56,"index":54,"name":"李愛文","work_number":"K0124813","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化一課-昆山","grade":"師6","position":"無管理職","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Beats案件VN產線新纖體LBU","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":57,"index":55,"name":"吳永斌","work_number":"J0273741","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化二課-昆山","grade":"師5","position":"副課長","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Beats案件VN產線新纖體LBU","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":58,"index":56,"name":"韋東辦","work_number":"J0534098","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化二課-昆山","grade":"師3","position":"無管理職","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Beats案件VN產線新纖體LBU","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":59,"index":57,"name":"陳艷榮","work_number":"F0106473","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化三課-昆山","grade":"師6","position":"專理","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Beats案件VN產線新纖體LBU","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":60,"index":58,"name":"成吉鋒","work_number":"J0537528","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化三課-昆山","grade":"師3","position":"無管理職","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Beats案件VN產線新纖體LBU","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":61,"index":59,"name":"熊俊","work_number":"J0534105","sbu":"ACE","real_factory":"昆山","real_unit":"ACE-SMT自動化一課-昆山","grade":"師7","position":"無","vn_date":"2024-03-09T00:00:00.000Z","back_date":"2024-03-16T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"FAD","work_task":"Tester buyoff","document":"ｖ","travel_order":"","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":62,"index":60,"name":"梅樹平","work_number":"F0516656","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1自動化","grade":"師7","position":"專理","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":6,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1自動化","work_task":"SP5插針不良分析及改善，結合調試進度視情況再安排回國(IDS1)","document":"ｖ","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":63,"index":61,"name":"岳華利","work_number":"F0504733","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1企劃","grade":"師7","position":"專理","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":6,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1企劃","work_task":"配合應對2月份AMD與3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":64,"index":62,"name":"梅淑芳","work_number":"F4860409","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1企劃","grade":"師4","position":"無","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":6,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1企劃","work_task":"配合應對2月份AMD與3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":65,"index":63,"name":"孫緒峰","work_number":"F0805210","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1品保","grade":"師8","position":"副理","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-15T00:00:00.000Z","days":6,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS1品保","work_task":"配合應對2月份AMD和3月份Intel客戶稽核(IDS1)","document":"ｖ","travel_order":"","credentials_issue":"","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":66,"index":64,"name":"夏麒原","work_number":"FIT0614","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3工程","grade":"師3","position":"無","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-23T00:00:00.000Z","days":14,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3工程","work_task":"機台評估","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"","shuttle":"","hostel":""},{"id":67,"index":65,"name":"戴衛軍","work_number":"F0545701","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3品保","grade":"師6","position":"課長","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-03-23T00:00:00.000Z","days":14,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3品保","work_task":"1.機台評估\n2.客戶承認資料測試","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"","shuttle":"","hostel":""},{"id":68,"index":66,"name":"鐘東成","work_number":"F0837712","sbu":"IDS PL3","real_factory":"寶科","real_unit":"IDS3品保","grade":"員3","position":"無","vn_date":"2024-03-10T00:00:00.000Z","back_date":"2024-04-08T00:00:00.000Z","days":30,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"IDS3品保","work_task":"產地移轉相關品質問題處理","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"ｖ","flight":"","shuttle":"","hostel":""},{"id":69,"index":67,"name":"曾呂武","work_number":"F0817991","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1沖壓一課","grade":"師7","position":"資深專理","vn_date":"2024-03-12T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":11,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"中央企劃","work_task":"Conn BU 建廠沖壓前期資源調研:\n1.向友商了解沖壓廠相關資訊(如沖壓建廠經驗/設備翻新狀況/模具備品加工資源等)\n2.與營建檢討沖壓車間建設細節討論(如冰水系統/切削油集中供油系統/沖壓清洗線/天車等建設)\n3.向中央人資了解沖壓相關專業人才招募&基礎人力補充及人員培養期等狀況\n4.拜訪鐘立文協理王明芬處長等駐越高階主管,相關資源獲取或需求協助\n5.考察義安廠區周邊商業&居住&交通資料,利于派駐越南動員宣傳","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":70,"index":68,"name":"尹萬明","work_number":"F0842623","sbu":"IDS1","real_factory":"寶科","real_unit":"IDS1沖壓一課","grade":"試用師7","position":"組長","vn_date":"2024-03-12T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":11,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"中央企劃","work_task":"Conn BU 建廠沖壓前期資源調研:\n1.向友商了解沖壓廠相關資訊(如沖壓建廠經驗/設備翻新狀況/模具備品加工資源等)\n2.與營建檢討沖壓車間建設細節討論(如冰水系統/切削油集中供油系統/沖壓清洗線/天車等建設)\n3.向中央人資了解沖壓相關專業人才招募&基礎人力補充及人員培養期等狀況\n4.向中央采購調研重型設備裝卸公司資源及資質狀況和化材(清洗劑/切削油等)廠商資源及資質\n5.義安廠區周邊商業&生活居住環境&交通等考察,利于派駐越南動員宣傳.","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":71,"index":69,"name":"林文祥","work_number":"TW7928","sbu":"IDS PL2","real_factory":"鄭州","real_unit":"成型","grade":"師11","position":"經理","vn_date":"2024-03-14T00:00:00.000Z","back_date":"2024-03-21T00:00:00.000Z","days":8,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"中央企劃","work_task":"Conn BU 建廠成型前期資源調研:\n1.向友商了解成型廠相關資訊(如成型建廠經驗/設備翻新狀況/模具備品加工資源等)\n2.與營建檢討成型車間建設細節討論(如廢氣系統/中二階/行車等建設)\n3.向中央人資了解成型相關專業人才招募&基礎人力補充及人員培養期等狀況\n4.向中央采購調研包材廠商資源及資質\n5.義安廠區周邊商業&生活居住環境&交通等考察,利于派駐越南動員宣傳.","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":72,"index":70,"name":"史榮平","work_number":"F0519481","sbu":"IDS PL2","real_factory":"鄭州","real_unit":"IDS2成型二課","grade":"師7","position":"專理","vn_date":"2024-03-14T00:00:00.000Z","back_date":"2024-03-22T00:00:00.000Z","days":9,"visa_date":"1970-01-01T00:00:00.000Z","visa":"商務","resident":"N","vn_factory":"雲中","vn_unit":"中央企劃","work_task":"Conn BU 建廠成型前期資源調研:\n1.向友商了解成型廠相關資訊(如成型建廠經驗/設備翻新狀況/模具備品加工資源等)\n2.與營建檢討成型車間建設細節討論(如廢氣系統/中二階/行車等建設)\n3.向中央人資了解成型相關專業人才招募&基礎人力補充及人員培養期等狀況\n4.向中央采購調研包材廠商資源及資質\n5.義安廠區周邊商業&生活居住環境&交通等考察,利于派駐越南動員宣傳.","document":"ｖ","travel_order":"ｖ","credentials_issue":"ｖ","credentials_allot":"","flight":"","shuttle":"","hostel":""},{"id":227,"index":70,"name":"ABC","work_number":"FIT1234","sbu":"ACE","real_factory":"昆山","real_unit":"自動化","grade":"師10","position":"工程師","vn_date":"2024-04-02T00:00:00.000Z","back_date":"2024-04-30T00:00:00.000Z","days":29,"visa_date":"2024-04-17T00:00:00.000Z","visa":"工作","resident":"出差","vn_factory":"雲中","vn_unit":"ABS","work_task":"廠房建置","document":"已完成","travel_order":"已完成","credentials_issue":"已完成","credentials_allot":"已完成","flight":"BR1234","shuttle":"Jerry","hostel":"富貴城"}]};
                let tempItems = response.data.map(x=>{
                    if(x.vn_date !== null && x.vn_date !== "")
                    {
                        x.vn_date = x.vn_date.slice(0, 10);
                    }
                    else
                    {
                        x.vn_date = "";
                    }
                    if(x.back_date !== null && x.back_date !== "")
                    {
                        x.back_date = x.back_date.slice(0, 10);
                    }
                    else
                    {
                        x.back_date = "";
                    }
                    if(x.visa_date !== null && x.visa_date !== "")
                    {
                        x.visa_date = x.visa_date.slice(0, 10);
                    }
                    else
                    {
                        x.visa_date = "";
                    }
                    
                    this.fields.forEach(aField=>{
                        if(x[aField.key] === null || x[aField.key] === "null")
                        {
                            //console.log(aField.key);
                            x[aField.key] = "";
                        }
                    })
                    return x;
                });

                //filter
                this.rawItems = tempItems;

                this.filterProcess();
                
                //for test end
                */
                
                fetch(`http://10.35.7.180:31881/api/vn_attendance/travel-management`, {
                    method: 'GET', // 或其他 HTTP 方法，視你的需求而定
                    headers: {
                        'Authorization': `Bearer ${this.access_token}`,
                        'Content-Type': 'application/json', // 請根據 API 的要求設置 Content-Type
                    }
                })
                .then((response) => {
                    console.log(response);
                    if(response.status !== 200)
                    {
                        this.toast('讀取總覽', `讀取失敗: ${response.status}`);
                        //console.log(response);
                        return {success: false};
                        
                    }
                    else
                    {
                        return response.json();
                    }
                })
                
                .then( (response) => {
                    //console.log(response);
                    if(response.success)
                    {
                        //this.searchResult = response.data;
                        let tempItems = response.data.map(x=>{
                            if(x.vn_date !== null && x.vn_date !== "" && x.vn_date !== '1970-01-01T00:00:00.000Z')
                            {
                                x.vn_date = x.vn_date.slice(0, 10);
                            }
                            else
                            {
                                x.vn_date = "";
                            }
                            if(x.back_date !== null && x.back_date !== "" && x.back_date !== '1970-01-01T00:00:00.000Z')
                            {
                                x.back_date = x.back_date.slice(0, 10);
                            }
                            else
                            {
                                x.back_date = "";
                            }
                            if(x.visa_date !== null && x.visa_date !== "" && x.visa_date !== '1970-01-01T00:00:00.000Z')
                            {
                                x.visa_date = x.visa_date.slice(0, 10);
                            }
                            else
                            {
                                x.visa_date = "";
                            }
                            
                            this.fields.forEach(aField=>{
                                if(x[aField.key] === null || x[aField.key] === "null")
                                {
                                    //console.log(aField.key);
                                    x[aField.key] = "";
                                }
                            })
                            return x;
                        });

                        //filter
                        this.rawItems = tempItems;

                        this.filterProcess();
                    }
                    else
                    {
                        this.toast('讀取總覽', `讀取失敗(${response.code})`);
                    }
                })

                .catch((error) => {
                    //console.log(`ScadaViewData Error: ${error}`);
                    this.toast('讀取總覽', `讀取失敗: ${error}`);


                    
                })
                //this.$refs.table.refresh();
            },

            //過濾函式
            filterProcess(){
                this.filterSelection();
                this.filterKeyword();
                this.filterDate();
            },
            filterSelection(){
                this.rawItemsAfterSelection = this.rawItems.filter((x) => {
                    let res = true;
                    if(this.selectedSBU !== "All" && x.sbu !== this.selectedSBU)
                    {
                        res = false;
                    }
                    else if(this.selectedRealFactory !== "All" && x.real_factory !== this.selectedRealFactory)
                    {
                        res = false;
                    }
                    else if(this.selectedVnFactory !== "All" && x.vn_factory !== this.selectedVnFactory)
                    {
                        res = false;
                    }
                    return res;
                });
            },
            filterKeyword(){
                //console.log("filterKeyword: " + this.selectName);
                const filterColumns = ["name","work_task","work_number","vn_unit"];

                this.items = this.rawItemsAfterSelection.filter((x) => {
                    let res = false;

                    if(this.selectName === "")
                    {
                        res = true;
                    }
                    else
                    {
                        for(let i = 0; i < filterColumns.length; i++)
                        {
                            if(x[filterColumns[i]] !== undefined &&
                                x[filterColumns[i]] !== null && 
                                x[filterColumns[i]].toLowerCase().indexOf(this.selectName.toLowerCase()) !== -1)
                            {
                                res = true;
                                break;
                            }
                        }
                    }

                    //處理searchDate
                    /*let param_searchDate = this.urlParams("searchDate");
                    if(this.isValidDate(param_searchDate))
                    {
                        this.searchDate = new Date(param_searchDate).toISOString().slice(0,10);
                    }*/

                    return res;
                });
            },
            filterDate(){

                const filteredItems = this.items.filter(items => {
                    const vnDate = new Date(items.vn_date);
                    const backDate = new Date(items.back_date);
                    const startDate = new Date(this.startDate);
                    const endDate = new Date(this.endDate);

                    if(backDate.getTime()===0)  //1970-01-01
                    {
                        return vnDate <= endDate;
                    }
                    else
                    {
                        //滿足已下條件false
                        return !(
                            (vnDate < startDate && backDate < startDate) || (vnDate > backDate && vnDate > endDate)
                        )
                    }
                    
                });
              this.items = filteredItems;
            },


            toHtml: function(str){
                return str !== undefined? str.replace(/\n/g, '<br>'): "";
            },


            calculateDays(date1 , date2) {
                let result = "";
                if (date1 !== undefined && date1 !== "" && date2 !== undefined && date2 !== "" ) {
                    const start = new Date(date1.replace(/\//g, '-'));
                    const end = new Date(date2.replace(/\//g, '-'));

                    // 計算兩個日期之間的天數
                    const timeDiff = Math.abs(end - start);
                    const days = Math.ceil(timeDiff / (1000 * 60 * 60 * 24) + 1);

                    result = days;
                    
                } else {
                    // 如果起始日期或結束日期為空，清空計算結果
                    result = 0;
                }

                    return result;
                },
            
            //Excel解析
            chooseFile() {
                this.$refs.fileInput.value = null;
                this.$refs.fileInput.click();
            },
            readAndDisplayExcel() {
                this.processDone = false;
                this.excelData = [];
                this.itemsImport = [];
                this.statusUpload = [];

                var input = document.getElementById('excelFile');
                var file = input.files[0];

                if (file) {
                    var reader = new FileReader();

                    reader.onload = (e) => {
                        var data = new Uint8Array(e.target.result);
                        var workbook = XLSX.read(data, {
                            type: 'array'
                        });

                        // Get data from the first sheet only
                        var firstSheetName = workbook.SheetNames[0];
                        var sheet = workbook.Sheets[firstSheetName];
                        //console.log (sheet)
                        // Convert the first sheet to JSON
                        var sheetData = XLSX.utils.sheet_to_json(sheet, {
                            header: 1
                        });
                        //let a = JSON.parse(JSON.stringify(sheetData));
                        //console.log(a);
                        //console.log(sheetData)
                        if (sheetData.length > 0) {
                            //delete row 1 (because it's title row)
                            sheetData = sheetData.slice(1);
                            sheetData = sheetData.filter((item) => item.length > 0);
                            
                            
                            
                            
                            //process a row into a object
                            this.excelData = this.modifySheetData(sheetData);

                            /*item.filter((x)=>(x===undefined)).length===0
                            let emptyItemNumber = this.excelData.filter((item) => Object.values(item).findIndex((x)=>(x===undefined)) !== -1).length;
                            if(emptyItemNumber > 0)
                            {alert("警告!有" + emptyItemNumber + "項帶有空值的項目!");} */


                            if (this.excelData && this.excelData.length > 0) {
                            let emptyItemNumber = this.excelData.filter((item) => Object.values(item).findIndex((x) => x === undefined) !== -1).length;
                            if (emptyItemNumber > 0) {
                                alert("警告！有" + emptyItemNumber + "项带有空值的项目！");
                                this.uploadButtonDisabled = true;
                            } else {
                                
                                this.uploadButtonDisabled = false;
                            }
                            } else {
                                alert("警告！excelData为空！");
                                this.uploadButtonDisabled = true;
                            }
                                                    

                            this.itemsImport = this.excelData;
                            this.statusUpload = Array(this.itemsImport.length).fill("未上傳");
                            //console.log(this.itemsImport);
                            //console.log(this.statusUpload);

                            // Update the processDone flag
                            //if(emptyItemNumber === 0) { }
                            this.processDone = true;
                            
                        } else {
                            alert('Selected Excel file is empty.');
                        }
                        
                    };

                    reader.readAsArrayBuffer(file);
                }
            },
            handleFileChange() {
                this.readAndDisplayExcel();
            },
            
            //匯出excel檔案(套裝可以挪用改KEY)
            exportFile(){

                let filename = `出差人員總覽_${new Date().toISOString().slice(0,10).replace(/-/g,'')}`;
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet(filename, {views:[{state: 'frozen', xSplit: 5, ySplit:1}]});

                // 添加標題行
                let outputFields = this.fields.filter(x=>x.label!=="序號"); //去掉序號
                const headerRow = worksheet.addRow(outputFields.map(field => field.label));   
                headerRow.font = { bold: true };

                // 添加數據行
                
                this.items.forEach(item => {
                    const dataRow = worksheet.addRow(this.fields.map(field => {
                        if(field.key === 'vn_date' ||
                            field.key === 'back_date' ||
                            field.key === 'visa_date' )
                        {
                            console.log(item[field.key])
                            if(item[field.key] === '1970-01-01')
                            {
                                return '';
                            }
                            else
                            {
                                return item[field.key].replace(/-/g,'/');
                            }
                        }
                        else
                        {
                            return item[field.key];
                        }
                    }));   //去掉序號
                    // 你可以在這裡添加更多的格式設置，例如文本格式、日期格式等
                    /*
                    dataRow.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' },
                    };
                    */
                });

                //const allBordersStyle = { style: 'thick' };
                //worksheet.getCell('A1').border = { ...allBordersStyle, bottom: { style: 'thin' } };
                //worksheet.getCell(`A${worksheet.rowCount}`).border = { ...allBordersStyle, top: { style: 'thin' } };
                let widthArray = [6,10.29,13.29,10,25,10.29,25.43,30.29,25,12.86,10.29,20,20,25.43,40,10.29,40,25.43,10.29,40,25.43,40,40,40,40];
                for(let x = 1; x <= worksheet.columns.length; x++)
                {
                    //指定寬度
                    worksheet.getColumn(x).width = widthArray[x-1];
                    for(let y = 1; y <= worksheet.rowCount; y++)
                    {
                        let aBorder = {
                            top: {style: 'thin'},
                            left: {style: 'thin'},
                            bottom: {style: 'thin'},
                            right: {style: 'thin'},
                        };

                        if(x === 1)
                        {
                            aBorder.left.style = 'thick';
                        }
                        else if(x === worksheet.columns.length)
                        {
                            aBorder.right.style = 'thick';
                        }
                        if(y === 1)
                        {
                            aBorder.top.style = 'thick';
                            aBorder.bottom.style = 'thick';
                        }
                        else if(y === worksheet.rowCount)
                        {
                            aBorder.bottom.style = 'thick';
                        }

                        worksheet.getRow(y).getCell(x).border = aBorder;
                    }
                }


                // 將工作簿保存為 Excel 文件
                workbook.xlsx.writeBuffer().then(buffer => {
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `${filename}.xlsx`;
                    link.click();
                });
            },
            exportnullFile(){

                let filename = `出差人員總覽_${new Date().toISOString().slice(0,10).replace(/-/g,'')}`;
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet(filename, {views:[{state: 'frozen', xSplit: 5, ySplit:1}]});

                // 添加標題行
                let outputFields = this.fields.filter(x=>x.label!=="序號"); //去掉序號
                const headerRow = worksheet.addRow(outputFields.map(field => field.label));   
                headerRow.font = { bold: true };
                
                let widthArray = [6,10.29,13.29,10,25,10.29,25.43,30.29,25,12.86,10.29,20,20,25.43,40,10.29,40,25.43,10.29,40,25.43,40,40,40,40];
                for(let x = 1; x <= worksheet.columns.length; x++)
                {
                    //指定寬度
                    worksheet.getColumn(x).width = widthArray[x-1];
                    for(let y = 1; y <= worksheet.rowCount; y++)
                    {
                        let aBorder = {
                            top: {style: 'thin'},
                            left: {style: 'thin'},
                            bottom: {style: 'thin'},
                            right: {style: 'thin'},
                        };

                        if(x === 1)
                        {
                            aBorder.left.style = 'thick';
                        }
                        else if(x === worksheet.columns.length)
                        {
                            aBorder.right.style = 'thick';
                        }
                        if(y === 1)
                        {
                            aBorder.top.style = 'thick';
                            aBorder.bottom.style = 'thick';
                        }
                        else if(y === worksheet.rowCount)
                        {
                            aBorder.bottom.style = 'thick';
                        }

                        worksheet.getRow(y).getCell(x).border = aBorder;
                    }
                }


                // 將工作簿保存為 Excel 文件
                workbook.xlsx.writeBuffer().then(buffer => {
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `${filename}.xlsx`;
                    link.click();
                });
                },
            formatDate(numb, format = '-') {
                if(numb === undefined)
                {
                    return "";
                }
                else if(numb === "")
                {
                    return "";
                }
                else if (isNaN(numb)) {
                    let dateParts = numb.split('/');
                    if (dateParts.length === 3) {
                        let y = dateParts[0];
                        if (!isNaN(y) && parseInt(y) > 100 && parseInt(y) < 2000) {
                            return (parseInt(y) + 1911) + "-" + dateParts[1] + "-" + dateParts[2];
                        } else {
                            return dateParts[0] + "-" + dateParts[1] + "-" + dateParts[2];
                        }
                    } else if (dateParts.length === 2) {
                        let yyyy = this.excelData[0][0].class_date.slice(0, 4);
                        return yyyy + "-" + dateParts[0] + "-" + dateParts[1];
                    }
                    else
                    {
                        return "";
                    }
                } else {
                    const time = new Date((numb - 25567) * 24 * 3600000 - 5 * 60 * 1000 - 43 * 1000 - 24 * 3600000 - 8 * 3600000)

                    time.setYear(time.getFullYear())
                    const year = time.getFullYear() + ''
                    const month = time.getMonth() + 1 + ''
                    const date = time.getDate() + ''
                    if (format && format.length === 1) {
                        return year + format + (month < 10 ? '0' + month : month) + format + (date < 10 ? '0' + date : date)
                    } else {
                        return year + (month < 10 ? '0' + month : month) + (date < 10 ? '0' + date : date);
                    }
                }

            },
            defaultEmptyString(str){
                return str === undefined? "": str;
            },
            modifySheetData(sheetData) {
                //console.log(sheetData)
                return sheetData.map((row) => {
                    //console.log(row)
                    row[9] = this.formatDate(row[9]);
                    row[10] = this.formatDate(row[10]);
                    row[12] = this.formatDate(row[12]);
                    row[11] = this.calculateDays(row[9],row[10])
                    const res = {
                            index:              this.defaultEmptyString(row[0] ),       
                            name:               this.defaultEmptyString(row[1] ),        
                            work_number:        this.defaultEmptyString(row[2] ), 
                            sbu:                this.defaultEmptyString(row[3] ),         
                            real_factory:       this.defaultEmptyString(row[4] ),
                            real_unit:          this.defaultEmptyString(row[5] ),
                            unit_number:        this.defaultEmptyString(row[6] ),  
                            grade:              this.defaultEmptyString(row[7] ),       
                            position:           this.defaultEmptyString(row[8] ),    
                            vn_date:            this.defaultEmptyString(row[9] ),     
                            back_date:          this.defaultEmptyString(row[10] ),   
                            days:               this.defaultEmptyString(row[11]),        
                            visa_date:          this.defaultEmptyString(row[12]),   
                            visa:               this.defaultEmptyString(row[13]),        
                            resident:           this.defaultEmptyString(row[14]),    
                            vn_factory:         this.defaultEmptyString(row[15]),  
                            vn_unit:            this.defaultEmptyString(row[16]),     
                            work_task:          this.defaultEmptyString(row[17]),
                            window:             this.defaultEmptyString(row[18]),
                            management_table:    this.defaultEmptyString(row[19]),
                            document:           this.defaultEmptyString(row[20]),         
                            travel_order:       this.defaultEmptyString(row[21]),     
                            credentials_issue:  this.defaultEmptyString(row[22]),
                            credentials_allot:  this.defaultEmptyString(row[23]),
                            key:                this.defaultEmptyString(row[24]),           
                            shuttle:            this.defaultEmptyString(row[25]),          
                            hostel:             this.defaultEmptyString(row[26]),           
                    };
                    //console.log(res);
                    return res;
                });
            },
            formatTime(numb, format = '-') {
                if (isNaN(numb)) {
                    numb = numb.replace("“", ":");
                    let date = "";
                    let timeParts = numb.split(':');
                    if (timeParts[0].indexOf("/") !== -1 && timeParts[0].indexOf(" ") !== -1) //還帶有日期
                    {
                        date = timeParts[0].split(" ")[0];
                        date = this.formatDate(date) + " ";
                        timeParts[0] = timeParts[0].split(" ")[1];
                    }

                    if (timeParts.length === 3) {
                        return date + timeParts.join(":");
                    } else if (timeParts.length === 2) {
                        return date + timeParts.join(":") + ":00";
                    } else {
                        alert("無法解析的時間：" + numb);
                    }
                } else {
                    let totalSeconds = numb * 24 * 60 * 60;
                    let hours = Math.floor(totalSeconds / 3600);
                    let minutes = Math.floor((totalSeconds % 3600) / 60);
                    let seconds = Math.floor(totalSeconds % 60);
                    let res = ((hours < 10) ? '0' + hours : hours) + ":" +
                        ((minutes < 10) ? '0' + minutes : minutes) + ":" +
                        ((seconds < 10) ? '0' + seconds : seconds);
                    return res;
                }
            },

            //更新暫存
            importmodal() {
                //this.$refs.fileInput.click();
                this.itemsImport = [];
                // 顯示模態視窗
                this.$bvModal.show("modalimport");
            },
    
            travelSelectedEditItemIsValid(){
                let res = false;
                if( 
                    this.selectedEditItem.name !== "" &&
                    this.selectedEditItem.work_number !== "" &&
                    this.selectedEditItem.sbu !== "" &&
                    this.selectedEditItem.real_factory !== "" && 
                    this.selectedEditItem.grade !== "" && 
                    this.selectedEditItem.position !== "" && 
                    this.selectedEditItem.vn_date !== "" &&   
                    this.selectedEditItem.visa !== "" &&
                    this.selectedEditItem.vn_factory !== "" &&
                    this.selectedEditItem.vn_unit !== "" )
                {
                    res = true;
                }
                return res;
            },

            itemInsert(refItem){
                let newItem = {
                    new: true,
                };
                this.fields.forEach((field)=>{
                    if(refItem === null)
                    {
                        newItem[field.key] = "";
                    }
                    else
                    {
                        newItem[field.key] = refItem[field.key];
                    }
                });

                newItem.index = this.rawItems.length;
                //newItem.class_date = new Date().toISOString().slice(0, 10);
                
               
                this.itemEdit(newItem);
            },
            itemEdit(item){
                this.selectedItem = item;
                let tempItem = this.clonedObject(item);
            
                //確認一下時間欄位
                this.itemDateCheck_toShow(tempItem, "vn_date");
                this.itemDateCheck_toShow(tempItem, "back_date");
                this.itemDateCheck_toShow(tempItem, "visa_date");

                this.selectedEditItem = tempItem;
                
                this.$bvModal.show('modal-item-edit');
            },
            itemDateCheck_toShow(item, key)
            {
                if(item[key] === undefined)
                {
                    item[key] = '';
                }
                else
                {
                    //處理成 yyyy-MM-dd的造型
                    item[key] = item[key].slice(0, 10);
                    //處理成 yyyy-MM-dd的造型
                    if(item[key] === '1970-01-01')
                    {
                        item[key] = '';
                    }
                }
            },
            
            //繪製圖表區START
            renderChart(){
                // 建構配置項
                const perthFunc = this.perth;
                const options = {
                    scales: {
                        y1: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: "",   //y軸標題
                            },
                            ticks: {
                                color: '#eeeeee',
                                beginAtZero: true,
                                responsive: true, //符合響應式
                                maxTicksLimit: 6,
                                callback: function(v){
                                    return perthFunc(Math.round(v/1000)) + " KUSD";
                                },
                            },
                            gridLines:{
                                display: true,
                                color: 'gray',
                            },
                        },
                        x: {
                            ticks: {
                                responsive: true, //符合響應式
                                fontSize: 16,
                                color: '#eeeeee',
                            },
                            offset: true,
                        },
                    },
                    title: {
                        display: true,
                        fontSize: 16,
                        fontColor: 'black',
                    },
                    
                    layout:{
                        padding: {
                            top: 50,
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels:{
                                font:{
                                    size: 20,
                                }, 
                                color: '#eeeeee',
                            },
                        },
                        tooltip: {
                            
                        },
                    },
                    aspectRatio: 5, // 寬高比5:1
                    responsive: true,
                    maintainAspectRatio: false,
                };

                if(this.theChart === null)
                {
                    // 取得 canvas 元素
                    const ctx = document.getElementById('theChart').getContext('2d');
                    this.theChart = new Chart(ctx, {
                        type: 'line',
                        data: {},
                        plugins: [ChartDataLabels], //增加這行
                        options: options
                    });
                }

                this.theChart.clear();

                // 建構數據
                let chartInfo = {}, chartData;
                let key;
                let value;

                chartData = this.items.filter(x=>x.sbu==='Conn BU');
                chartData.forEach(item=>{
                    if(this.monthlyFlag)
                    {
                        //console.log(item.date);
                        if(item.date.indexOf("total") === -1 && item.date.indexOf("Q") === -1)   //過濾掉total和季度的項目
                        {
                            chartInfo[new Date(item.date).getMonth()+1] = item;
                        }
                    }
                    else
                    {
                        chartInfo[new Date(item.date).getDate()] = item;
                    }
                });

                let labels;
                if(this.monthlyFlag)    //月份為x坐標
                {
                    labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                }
                else
                {
                    labels = this.fields.map(x=> new Date(x.key).getDate());
                }
                const dataTargetRevenue = labels.map((lbl, idx)=>{
                    return chartInfo[idx+1] === undefined ? 0 : chartInfo[idx+1].target_revenue;
                });
                const dataActualRevenue = labels.map((lbl, idx)=>{
                    return chartInfo[idx+1] === undefined ? 0 : chartInfo[idx+1].actual_revenue;
                });
                
                const datasets = [{
                    type: 'line', //圖表類型
                    label: '營收目標(KUSD)', //標籤
                    data: dataTargetRevenue,
                    xAxisID: 'x',
                    yAxisID: 'y1',
                    fill: false,
                    backgroundColor: '#36a2eb',
                    borderColor: '#36a2eb',
                    borderWidth: 1,
                    //tension: 0,
                    datalabels: {
                        /*
                        display: function(ctx) {
                            return ctx.datasetIndex === 1;
                        },
                        */                            
                        formatter: function(value, context) {   //最多保留到小數後第二位
                            return Math.round(value/10)/100;
                        },
                        color: '#36a2eb',
                        anchor: 'end',
                        align: 'end',
                        offset: 30,
                        font: {
                            size: 16,
                        }
                    },
                },{
                    type: 'line', //圖表類型
                    label: '實際營收(KUSD)', //標籤
                    data: dataActualRevenue,
                    xAxisID: 'x',
                    yAxisID: 'y1',
                    fill: false,
                    backgroundColor: '#ffcd56',
                    borderColor: '#ffcd56',
                    borderWidth: 1,
                    datalabels: {
                        //display: false,
                        formatter: function(value, context) {   //最多保留到小數後第二位
                            return Math.round(value/10)/100;
                        },
                        color: '#ffcd56',
                        anchor: 'end',
                        align: 'end',
                        offset: 10,
                        font: {
                            size: 16,
                        }
                    },
                },];

                this.theChart.data = {
                    labels: labels,
                    datasets: datasets,
                }

                

                this.theChart.update();
            },
            resetCanvas(){
                if(this.theChart !== null)
                {
                    this.theChart = null;
                }
            },
            //繪製圖表區END


            
            //單項新增
            updatetravelSummary(){

                if(this.selectedEditItem.new)
                {

                    delete this.selectedEditItem.new;
                    this.selectedItem.index = 0;
                }
                
                this.itemsImport = [this.selectedEditItem];
                this.statusUpload = ["未上傳"];
                //console.log(this.selectedEditItem);

                this.startApiProcess();

            },
            
            mangerDelete(){
                //console.log("A")
                this.$bvModal.show('modal-item-delete-confirm');
            },

            deletetravelSummary(){
                fetch(`http://10.35.7.180:31881/api/vn_attendance/travel-management`, 
                {
                    method: "DELETE",
                    headers: {
                        'Authorization': `Bearer ${this.access_token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify([this.selectedItem])
                })
                .then(response => response.json())
                .then(json => {
                    //console.log(json);
                    this.toast("刪除數據","刪除成功");
                    this.searchProcess();

                    this.$bvModal.hide('modal-item-edit');
                })
                .catch((error)=>
                {
                    this.toast('刪除數據', `刪除失敗：${error}`);
                });
            },
            deleteidentifier(){
                fetch(`http://10.57.20.154:8096/checklist-api/equipments/${this.selectedItem.identifier}`, 
                {
                    method: "DELETE",
                    headers: {
                        'Authorization': `Bearer ${this.access_token}`,
                        'Content-Type': 'application/json',
                    },
                    //body: JSON.stringify([this.selectedItem])
                })
                .then(response => response.json())
                .then(json => {
                    //console.log(json);
                    this.toast("刪除數據","刪除成功");
                    this.searchProcess();

                    this.$bvModal.hide('modal-item-edit');
                })
                .catch((error)=>
                {
                    this.toast('刪除數據', `刪除失敗：${error}`);
                });
            },

            localizeDate: function(tsString, defaultStr){
                if(tsString  === "")
                {
                    return defaultStr;
                }
                //timestamptz若為0，就回傳空白
                let d = new Date(tsString);
                if(d.getTime() === 0)
                {
                    return defaultStr;
                }
                else
                {
                    return d.toLocaleString('sv', { hour12: false }).slice(0,10).replace(/-/g,"/");
                }
            },

            toast(title, msg) {
                this.$bvToast.toast(msg, {
                    title: title,
                    toaster: 'b-toaster-top-center',
                    autoHideDelay: 2000,
                    opacity: 1,
                    appendToast: false,
                })
            },
            
            onFiltered(filteredItems) {
                // Trigger pagination to update the number of buttons/pages due to filtering
                this.totalRows = filteredItems.length;
                this.currentPage = 1;
            },
            
            perth: function(value){     //顯示數值的千分號
                if (!value) return 0;
                value = parseFloat(value);
                // 獲取整數部分
                const intPart = Math.trunc(value)
                // 整數部分處理，增加,
                const intPartFormat = intPart.toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,')
                // 預定義小數部分
                let floatPart = ''
                // 將數值截取為小數部分和整數部分
                const valueArray = value.toString().split('.')
                if (valueArray.length === 2) { // 有小數部分
                    floatPart = valueArray[1].toString() // 取得小數部分
                    return intPartFormat + '.' + floatPart
                }
                return intPartFormat + floatPart
            },
            wSign: function(value){
                let res = value;
                if(res > 100000)
                {
                    res = Math.round(res/10000);
                    res = this.perth(res) + "萬";
                }
                else if(res > 10000)
                {
                    res = Math.round(res/1000) / 10;
                    res = this.perth(res) + "萬";
                }
                else
                {
                    res = this.perth(res);
                }

                return res;
            },
            
            weekday(aDateStr){
                const dayArray = ["日","一","二","三","四","五","六"];
                var res = '';
                if(aDateStr !== '')
                {
                    res = dayArray[new Date(aDateStr).getDay()];
                }
                return res;
            },

            showVersion(){
                alert(this.versionHistory.join("\r\n"));
            },

            
            //cookie相關函式 START
            setCookie: function(key, value){
                document.cookie = key + "=" + value;
            },
            setCookies: function(keys, values){
                keys.forEach((key, idx) => {
                    this.setCookie(key, values[idx]);
                });
            },
            setCookieWithExpires: function(key, value, expiredSec){
                this.setCookie(key, value + "; max-age=" + expiredSec);
            },
            getCookie: function(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            },
            //cookie相關函式 END

            //和token相關的項目(methods) START
            urlParams(key){
                const urlSearchParams = new URLSearchParams(window.location.search);
                return urlSearchParams.get(key) || '';
            },
            
            
            clonedObject(obj){
				return JSON.parse(JSON.stringify(obj));
			},
            
            
            
            editModalShown(b){
                this.editModalIsShown = b;
                //console.log("editModalIsShown: " + this.editModalIsShown);
            },
            
            //上傳API
            startApiProcess() {
                //console.log("123");

                    let uploadItems = this.itemsImport.map(x => {
                        let y = JSON.parse(JSON.stringify(x));
                        if(y.vn_date === "")
                        {
                            //delete y.vn_date;
                            y.vn_date = '1970-01-01T00:00:00.000Z';
                        }
                        if(y.back_date === "")
                        {
                            y.back_date = '1970-01-01T00:00:00.000Z';
                            //delete y.back_date;
                        }
                        if(y.visa_date === "")
                        {
                            //delete y.visa_date;
                            y.visa_date = '1970-01-01T00:00:00.000Z';
                        }
                        return y;
                    });

                    //console.log(uploadItems);

                    fetch('http://10.35.7.180:31881/api/vn_attendance/travel-management', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            
                        },
                        body: JSON.stringify(uploadItems),
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`API 請求失敗，HTTP 狀態碼: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        //console.log('API 回應:', data);
                        this.toast("上傳人員總覽","上傳成功");

                        this.searchProcess();
                        this.$bvModal.hide("modal-item-edit")
                    })
                    .catch(error => {
                        console.error('API 請求錯誤:', error);
                        this.toast("上傳人員總覽","上傳失敗");
                    });
                
            },


            nextUploadNode(){

                this.$forceUpdate();

                if(this.uploadIdx + 1 < this.itemsImport.length)
                {
                    this.uploadIdx = this.uploadIdx + 1;
                    this.fetchDataFromAPI1();
                }
                else
                {
                    this.searchProcess();
                    //console.log('上傳完成');
                }
            },

            rowClass(item, type) {
                if (!item || type !== 'row') return;
                
                if (Object.values(item).findIndex(x=>x===undefined)!==-1) 
                {
                    return 'table-color-red';
                }
                else if(this.itemsImport.indexOf(item)%2 === 0)
                {
                    return 'table-even';
                }
                else
                {
                    return 'table-odd';
                }
            },
            
            validClass(item, type) {


                if (!item || type !== 'row') return;
                
                if (item.editor=== null ||  item.manager=== null)
                {
                    return 'table-color-red';
                }
                else if(this.items.indexOf(item)%2 === 0)
                {
                    return 'table-even';
                }
                else
                {
                    return 'table-odd';
                }
            },

            //toast需掛上套件
            toast(title, msg) {
                this.$bvToast.toast(msg, {
                    title: title,
                    toaster: 'b-toaster-top-center',
                    autoHideDelay: 2000,
                    opacity: 1,
                    appendToast: false,
                })
            },
        
        
            updateUserAuth(authDict){
                //console.log(authDict);
                this.isViewer = authDict.isViewer;
                this.isEditor = authDict.isEditor;
                this.candownload = authDict.candownload;
            },
            updatePortal(isPortal)
            {
                this.isPortal = isPortal;
            },
            updateUser(userInfo){
                this.userInfo = userInfo;
            },
        },
        components:{
            loginModule,
        },
    });
</script>

<style>
    body {
		background-color: #040c21;
		color: #eeeeee;
		font-size: 2.5vmin;
	}

	.page-title{
        display: inline-block; 
        margin: 0px; 
        font-size: 3.2vmin; 
        color:#a2d5f8; 
    }

	.header-logo{
        float: left;
        width: 5vw;
        position: relative;
        z-index: 2;
        padding: 0.5vh 0.5vw;
    }

    .right-top-zone {
        position: absolute;
        right: 1vw;
        top: 1vw;
        display: flex;
    }

    .header {
        width: 100vw;
        height: 5vh;
    }

    .footer{
        font-size: 1.0rem;
        position: fixed;
        bottom: 0px;
        opacity: 0.2;
    }
    .footer:hover{
        opacity: 1;
    }

    .btn-costom-selection {
        background-color: #599bd5 !important;
        color: black !important;
    }

    .custom-container{
        max-width: 95vw;
        margin-left: auto;
        margin-right: auto;
    }



    .custom-table thead th {
        background-color: #194d86 !important;
        color: #eeeeee !important;
        font-size: 1.2rem;
        padding: 0px;
    }
    .custom-table-import thead th {
        background-color: #194d86 !important;
        color: #eeeeee !important;
        font-size: 1.2rem;
        padding: 0px;
    }
    
    /*
    .custom-table tbody tr:nth-child(even) {
        --bs-table-color-type: #eeeeee;
        --bs-table-bg-type: #05142f;
    }
    .custom-table tbody tr:nth-child(odd) {
        --bs-table-color-type: #eeeeee;
        --bs-table-bg-type: #0e2a52;
    }
    */

    .bg-costom-modal {
        background-color: white !important;
        color: black !important;
    }

    .modal-header .close {
        padding: 1rem;
        margin: -1rem -1rem -1rem auto;
    }
    button.close {
        
        padding: 0;
        background-color: transparent;
        border: 0;
    }

    /* width */
    ::-webkit-scrollbar {
    width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
    box-shadow: inset 0 0 5px grey; 
    border-radius: 10px;
    }
    
    /* Handle */
    ::-webkit-scrollbar-thumb {
    background: #1a62ae; 
    border-radius: 10px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
    background: #599bd5; 
    }

    .custom-bar button {
        --bs-btn-bg: #1a62ae;
        --bs-btn-border-color: #1a62ae;
        --bs-btn-hover-bg: #0f3b6f;
        --bs-btn-hover-border-color: #c0c4cc;
    }
    .custom-bar .dropdown-menu {
        --bs-dropdown-bg: rgba(0,54,98,.9);
        --bs-dropdown-border-color: #c0c4cc;
        --bs-dropdown-link-color: #eeeeee;

        --bs-dropdown-link-hover-color: #eeeeee;
        --bs-dropdown-link-hover-bg: #1a62ae;
    }
    .custom-bar input[type=date]{
        color-scheme: dark;
        background-color: #0f3b6f;
		border: 1px solid hsla(0,0%,100%,0);
		border-radius: 4px;
		margin-left: 1vw;
        margin-right: 1vw;
		font-size: 1rem;
		text-align: center;
    }

    .toast:not(.show) {
        display: block;
        color: #0d6efd;
        background-color: white;
    }
    .toast-header{
        justify-content: space-between;
    }

    .mytooltip {
        position: relative;
    }

    .pointer{
        cursor: pointer;
    }

    .mytooltip .mytooltiptext {
        visibility: hidden;
        position:absolute; 
        z-index:100;
        border:0.1vmin;
        background-color:#040c21;
        border-style:solid;
        border-width:0.1vmin;
        border-color:white;
        padding:0.3vmin;
        color:white; 
        top:3vmin; 
        left:2vmin;
        width: 10vw;
        text-align: center;
        opacity: 0.9;
    }
    .mytooltip:hover .mytooltiptext {
        visibility: visible;
    }

    .table-color-red {
        --bs-table-color: #fff700;
        --bs-table-bg: #ff0000;
        --bs-table-border-color: #a7b9b1;
        --bs-table-striped-bg: #c7dbd2;
        --bs-table-striped-color: #000;
        --bs-table-active-bg: #bcd0c7;
        --bs-table-active-color: #000;
        --bs-table-hover-bg: #c1d6cc;
        --bs-table-hover-color: #000;
        color: var(--bs-table-color);
        border-color: var(--bs-table-border-color);
    }
    .table-odd{
        --bs-table-color: #eeeeee;
        --bs-table-bg: #0e2a52;
        --bs-table-border-color: #a7b9b1;
        --bs-table-striped-bg: #c7dbd2;
        --bs-table-striped-color: #000;
        --bs-table-active-bg: #bcd0c7;
        --bs-table-active-color: #000;
        --bs-table-hover-bg: #c1d6cc;
        --bs-table-hover-color: #000;
        color: var(--bs-table-color);
        border-color: var(--bs-table-border-color);
    }
    .table-even{
        --bs-table-color: #eeeeee;
        --bs-table-bg: #05142f;
        --bs-table-border-color: #a7b9b1;
        --bs-table-striped-bg: #c7dbd2;
        --bs-table-striped-color: #000;
        --bs-table-active-bg: #bcd0c7;
        --bs-table-active-color: #000;
        --bs-table-hover-bg: #c1d6cc;
        --bs-table-hover-color: #000;
        color: var(--bs-table-color);
        border-color: var(--bs-table-border-color);
    }

    .bg-costom-modal {
        background-color: white !important;
        color: black !important;
    }


    .toast:not(.show) {
        display: block;
        color: #0d6efd;
        background-color: white;
    }
    .toast-header{
        justify-content: space-between;
    }
    .function-zone .valid-column{
        background-color: #194d86;
        font-size: .8vw;
        position: absolute;
        width: 70vw;
        left: 14vw;
        z-index: 2;
        border: solid;
        border-width: 1px;
        border-radius: 4px;
        padding: 5px;
    }
</style>